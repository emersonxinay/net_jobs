{% extends "base.html" %} {% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">Tus Conversaciones</h2>

  {% if conversations %}
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Puesto de Trabajo</th>
          <th>Fecha del Trabajo</th>
          <th>Pago</th>
          <th>Horas</th>
          <th>Último mensaje</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for conversation in conversations|sort(attribute='last_message_time',
        reverse=True) %}
        <tr>
          <td>{{ conversation.username }}</td>
          <td>{{ conversation.job_title or '(Sin puesto de trabajo)' }}</td>
          <td>{{ conversation.job_date or '(Fecha no especificada)' }}</td>
          <td>
            {{ '${:.2f}'.format(conversation.job_payment) if
            conversation.job_payment else '(No especificado)' }}
          </td>
          <td>
            {{ '{:.2f} horas'.format(conversation.job_hours) if
            conversation.job_hours else '(No especificado)' }}
          </td>
          <td>
            {{ conversation.last_message_time.strftime('%Y-%m-%d %H:%M') if
            conversation.last_message_time }}
          </td>
          <td>
            {% if conversation.job_id %}
            <a
              href="{{ url_for('chat', user_id=conversation.other_user_id, job_id=conversation.job_id) }}"
              class="btn btn-primary btn-sm"
            >
              Ver Chat
            </a>
            {% else %}
            <span class="text-muted">Trabajo no disponible</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="alert alert-info text-center">No tienes conversaciones aún.</div>
  {% endif %}

  <div class="text-center mt-4">
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary"
      >Volver al Dashboard</a
    >
  </div>
</div>
{% endblock %}
